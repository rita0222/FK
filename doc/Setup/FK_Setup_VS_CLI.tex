\documentclass[a4paper]{jsarticle}

\usepackage{ascmac}
\usepackage{eclbkbox}

\textwidth=520pt
\textheight=710pt
\oddsidemargin=-32pt
\evensidemargin=-32pt
\topmargin=-60pt

\begin{document}
\begin{center}
\begin{Large}
Fine Kernel ToolKit システム (Visual Studio CLI 版) \\
	セットアップマニュアル \\ ~ \\
FineKernel Project \\
\end{Large}
(2016/10/25版)
\end{center}

\section{Visual Studio のバージョンについて}
Fine Kernel ToolKit システム(以下 FK)は 
C\# や F\# などの .NET Framework 対応言語から利用可能な CLI バージョンを提供している。
現在は Visual Studio(以下 VS) 2013 と 2015 をサポートしている。
本マニュアルでは、VS2015 Community を前提に記述していく。

\section{前準備}

インストールの前に、まず Windows Update をかけて
OS を最新の状態にしておくこと。また、
インストールに 6G を必要とするので、
最低でも 8G 程度はドライブに空きを作っておく必要がある。

\section{Visual Studio 2015 Community のインストール}
Visual Studio 2015 Community (以下「VS」)のインストール方法は以下の通り。

\begin{enumerate}
 \item まず、下記URLにアクセスする。
  \begin{screen}
  \begin{center}
	\verb+http://www.microsoft.com/visualstudio/jpn/downloads+
  \end{center}
  \end{screen}

 \item ページの左側にある「Community を無料ダウンロード」を選択する。

 \item ダウンロードされるインストーラを起動する。

 \item インストールの種類は「既定」のままで問題ないが、
	以下の点を考慮するなら「カスタム」を選択する。
	\begin{itemize}
	\item よりインストールする量を減らしたい場合は、
		「Microsoft Web Developer Tools」を削除すると、
		2G ほど削減できる。

	\item C++での開発にも利用したい場合は、
		「カスタム」を選んで「Visual C++」の中の
		「Visual C++ 2015 用の共通ツール」も選択する。
		これで 3〜4G 程度増加する。
	\end{itemize}	
 \item 本体のインストールが終わるまで待つ。数十分を要する。

 \item インストールが終わったら「起動」を押し、起動することを確認する。

 \item マイクロソフトアカウントの設定を行う。(次章参照のこと。)

 \item 環境設定は、他の言語を利用しないなら「Visual C\#」を、
	C++ 等の別言語でも開発を行うなら「全般」を選択する。
	配色はお好みで。(後で設定にて変更可能)

 \item 初回の起動は数分かかることがあるので、しばらく待つ。

 \item 起動を確認したら終了する。

\end{enumerate}

\section{マイクロソフトアカウントの設定}

VS は、利用の際にマイクロソフトアカウントでサインインをしておく必要がある。
既に Skype や OneDrive、あるいは Windows ストア等を利用していて、
マイクロソフトアカウントを取得済みの場合、
それをそのまま用いてもよい。

マイクロソフトアカウントをまだ持ってない人は新規に取得する。
以下のページにアクセスし、指示に従う。
\begin{screen}
\begin{center}
	\verb+https://www.microsoft.com/ja-jp/msaccount/signup/default.aspx+
\end{center}
\end{screen}
新規にメールアドレスを作成してもよいが、大学のメールアドレスを利用することを推奨する。

なお、マイクロソフトではアカウント作成処理が同一 IP アドレスから行われた場合、
作成数を制限している。この処理のため、学内ネットワークから大勢が同時間に作成処理を
行うと、エラーとなってしまう。そのため、この作成は自宅で行うか、
スマートフォンを用いて行うことを推奨する。

\section{FK CLI 版のインストール}

C\# で FK のプログラミングを行うには、FK CLI版をインストールする必要がある。
これは以下の URL から「FK\_CLI」で始まるインストーラ(exeファイル)をダウンロードする。

\begin{screen}
\begin{center}
	\verb+http://osdn.jp/projects/fktoolkit/releases+
\end{center}
\end{screen}
ダウンロードの際、「ダウンロードしたユーザー数が少ないため、PCに問題を起こす可能性があります。」
というメッセージが表記される場合があるが、問題はない。

このインストーラを実行しようとすると、Windows 8.1 や 10 では
「Windows によって PC が保護されました」というメッセージが表示される場合があるが、
その場合は「詳細情報」をクリックして「実行」を選択する。あとは基本的に指示通りに
インストールを進めればよい。同時に OpenAL と Visual C++ 2013 のランタイムの
インストーラも起動されるので、これらもインストールを行う。

\section{開発の手順}

VS 上で FK を用いた C\# の開発は、まず「プロジェクト」を作成するところから
始める。プロジェクトの作成方法は以下の手順で行う。

\begin{enumerate}

 \item VS を起動する
	\footnote{「Blend for Visual Studio 2015」の方を起動しないように注意すること。}。

 \item 「ソリューションエクスプローラー」が表示されていない場合は、メニューの
	「表示」→「ソリューションエクスプローラー」を選択して表示させておく。

 \item 「ファイル」→「新規作成」→「プロジェクト」を選択する。

 \item 「新しいプロジェクト」ダイアログの左側で「テンプレート」→「Visual C\#」
	(または「テンプレート」→「その他の言語」→「Visual C\#」) を選択する。

 \item 同ダイアログの右側で「コンソールアプリケーション」を選択する。

 \item 名前を適当に入力し、場所の欄にプログラムソース等を置くフォルダを指定する。

 \item ソリューションエクスプローラー上の「参照」を右クリックし、
	「参照の追加」を選択する。

 \item 「参照マネージャー」ダイアログの右下にある「参照」ボタンを押す。

 \item Cドライブの「FK\_CLI」フォルダ→「bin」フォルダの中にある「FK\_CLI.dll」を選択し、
	「追加」ボタンを押す。

 \item 「OK」ボタンを押す。

\end{enumerate}

これで準備は完了である。

\section{ビルドと実行}

コードを記述したら、メニューの「ビルド」→「ソリューションのビルド」を選択することで
ビルド(コンパイル)ができる。その後、メニューの「デバッグ」→「デバッグの開始」で実行できる。
ショートカットキーは、ビルドが F6、実行は F5 が割り当てられることが多いが、
その他のショートカットが割り当てられることもあるので、メニューで確認しておくこと。

\section{開発の中断と再開}

開発を一旦中断する際は、「ファイル」→「全て保存」を選択した後、
VS を修了すればよい。

開発を再開する際には、以下の2つの方法がある。

\begin{itemize}
 \item VS を起動し、「ファイル」→「開く」→「プロジェクト/ソリューション」を選択する。
	その後、プロジェクトが置いてあるフォルダの「sln」ファイルを選択する。

 \item エクスプローラーにてプロジェクトを保存したフォルダを開き、
	そのフォルダの中にある「sln」ファイルを選択する。
\end{itemize}

\section{FK CLI 検証用プログラムコード}
以下に、検証用のプログラムコードを示す。
ビルドに成功すると、黄色い立方体が回転するアニメーションが表示される。\\ ~
\begin{breakbox}
\begin{small}
\begin{verbatim}
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using FK_CLI; // この行を忘れないこと。

namespace fk_CLI1 // ここには自分が作成したプロジェクト名が入る。
{
    class Program
    {
        static void Main(string[] args)
        {
            // マテリアルの初期化
            fk_Material.InitDefault();

            // ウィンドウの生成と設定
            var win = new fk_AppWindow();
            win.Size = new fk_Dimension(800, 800);
            win.BGColor = new fk_Color(0.3, 0.6, 0.8);

            // 立方体モデルの生成と設定
            var model = new fk_Model();
            model.Shape = new fk_Block(10.0, 10.0, 10.0);
            model.Material = fk_Material.Yellow;

            // 立方体モデルをウィンドウに登録
            win.Entry(model);

            // ウィンドウの表示
            win.Open();

            // メインループ
            while(win.Update() == true)
            {
                // 立方体の回転
                model.GlRotateWithVec(0.0, 0.0, 0.0, fk_Axis.Y, 0.01);
            }
        }
    }
}
\end{verbatim}
\end{small}
\end{breakbox}

\section{開発に関する諸注意}
\subsection{ファイル読み込み処理を行うプログラムを実行する場合}
プログラム上から画像や形状データなどを読み込むプログラムを作成した場合、
カレントフォルダはビルドされた実行ファイルの存在しているフォルダになる。

\subsection{ビルドしたファイルを他の環境で実行する場合}
作成してビルドできたプログラムを他者の PC 環境で実行する場合は、
bin フォルダ中の実行ファイルに加えて、FK\_CLI.dll も実行ファイルと同じフォルダに配置する必要がある。
Windows フォームや WPF を利用している場合は、FK\_FormHelper.dll も必要である。
更に、実行する PC に次の 3 つがインストールされている必要がある。

\begin{enumerate}
\item .NET Framework 4.5 以降
\item OpenAL(本パッケージインストール先の redist フォルダに収録)
\item Visual C++ 2013 再頒布可能パッケージ(本パッケージインストール先の redist フォルダに収録)
\end{enumerate}

.NET Framework 4.5 は Windows Update か Microsoft のサイトから、
OpenAL と Visual C++ 2013 再頒布可能パッケージは、
本パッケージインストール先の redist フォルダに収録されている、
oalinst.exe と vcredist\_x86.exe を実行することでインストール可能である。
成果物を配布する際にはこのことを周知しておく必要がある。

\end{document}
