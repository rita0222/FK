\documentclass[a4paper]{jsarticle}

\usepackage{ascmac}
\usepackage{boites}

\textwidth=520pt
\textheight=710pt
\oddsidemargin=-32pt
\evensidemargin=-32pt
\topmargin=-60pt

\begin{document}
\begin{center}
\begin{Large}
Fine Kernel ToolKit システム (Visual Studio CLI 版) \\
	セットアップマニュアル \\ ~ \\
FineKernel Project \\
\end{Large}
(2019/09/25版)
\end{center}

\section{Visual Studio のバージョンについて}
Fine Kernel ToolKit システム(以下 FK)は 
C\# や F\# などの .NET Framework 対応言語から利用可能な「CLI版」を提供している。
現時点では Visual Studio(以下 VS) の 2019 と 2017 をサポートしている。
本マニュアルでは、VS2019 Community を前提に記述していく。

\section{前準備}

インストールの前に、まず Windows Update をかけて
OS を最新の状態にしておくこと。また、
インストールに 10G を必要とするので、
最低でも 12G 程度はドライブに空きを作っておく必要がある。

\section{Visual Studio 2019 Community のインストール}
Visual Studio 2019 Community (以下「VS」)のインストール方法は以下の通り。

\begin{enumerate}
 \item まず、下記URLにアクセスする。
  \begin{screen}
  \begin{center}
	\verb+https://visualstudio.microsoft.com/ja/downloads/+
  \end{center}
  \end{screen}

 \item ページ内にある Visual Studio 2019 欄内の「Community」を選択する。

 \item ダウンロードされるインストーラを起動する。

 \item 表示されるダイアログから「.NETデスクトップ環境」のチェックを入れる。
	その他の項目については FK での開発には必要ないが、
	適宜自身が必要と思う項目を追加しておくとよい。

 \item 本体のインストールが終わるまで待つ。数十分を要する。

 \item 再起動が必要というダイアログが出た場合は、一度再起動する。

 \item マイクロソフトアカウントを取得していない場合、事前に取得しておく。
	アカウントの設定を行わなくてもその時点では使用できるが、
	30日で使用できなくなるので必ず取得して Visual Studio 内で登録しておくこと。

 \item Visual Studio 2019 を起動する。
	初回の起動は数分かかることがあるので、しばらく待つ。

 \item 起動を確認したら終了する。

\end{enumerate}

\section{マイクロソフトアカウントの設定}

VS は、利用の際にマイクロソフトアカウントでサインインをしておく必要がある。
既に Skype や OneDrive、あるいは Windows ストア等を利用していて、
マイクロソフトアカウントを取得済みの場合、
それをそのまま用いてもよい。

マイクロソフトアカウントをまだ持ってない人は新規に取得する。
以下のページにアクセスする。
\begin{screen}
\begin{center}
	\verb+https://login.live.com/+
\end{center}
\end{screen}
ここで「アカウントをお持ちでない場合、作成できます。」の「作成」の部分をクリックし、
あとは指示に従う。
大学のメールアドレスを利用することを推奨するが、
その他のアドレスをアカウントとして利用しても、
新規にメールアドレスを作成してもよい。

なお、マイクロソフトではアカウント作成処理が同一 IP アドレスから行われた場合、
作成数を制限している。この処理のため、学内ネットワークから大勢が同時間に作成処理を
行うと、エラーとなってしまう。そのため、この作成は自宅で行うか、
スマートフォンを用いて大学のネットワークに接続せずに行うことを推奨する。

\section{FK CLI 版のインストール}

C\# で FK のプログラミングを行うには、FK CLI版をインストールする必要がある。
これは以下の URL から「FK\_CLI19」で始まるインストーラ(exeファイル)をダウンロードする。

\begin{screen}
\begin{center}
	\verb+http://osdn.jp/projects/fktoolkit/releases+
\end{center}
\end{screen}
ダウンロードの際、「ダウンロードしたユーザー数が少ないため、PCに問題を起こす可能性があります。」
というメッセージが表記される場合があるが、問題ないのでそのまま継続していくこと。

このインストーラを実行しようとすると、
「Windows によって PC が保護されました」というメッセージが表示される場合があるが、
その場合は「詳細情報」をクリックして「実行」を選択する。あとは基本的に指示通りに
インストールを進めればよい。

インストールが終わった後、一度サインアウトか再起動を行っておくこと。

\section{開発の手順}

VS 上で FK を用いた C\# の開発は、まず「プロジェクト」を作成するところから
始める。プロジェクトの作成方法は以下の手順で行う。

\begin{enumerate}

 \item VS を起動する。

 \item 「新しいプロジェクトの作成」を選択する。

 \item 検索ボックスに「FK」と入力し、「FK\_CLI\_Template」を選択し「次へ」を押す。

 \item プロジェクト名は半角英数文字のみで適当に入力する。(デフォルトのままでもよい。)

 \item 「場所」はこのプログラムの置き場所になるので、
		個人の授業用フォルダなどを適切に選択しておく。

 \item 上記を選択したら「作成」を押す。

 \item 作業画面となったときに、もし「ソリューションエクスプローラー」が表示されていない場合は、
	メニューの「表示」→「ソリューションエクスプローラー」を選択して表示させておく。

\end{enumerate}

これで準備は完了である。

\section{ビルドと実行}

上記手順で作成したプロジェクトには、最初から「Program.cs」にサンプルコードが
記述されている。ソリューションエクスプローラーで「Program.cs」をダブルクリックすると、
プログラムの編集を行うことができる。

その状態でメニューの「ビルド」→「ソリューションのビルド」を選択することで
ビルド(コンパイル)ができる。その後、メニューの「デバッグ」→「デバッグの開始」で実行できる。
ショートカットキーは、ビルドが F7、実行は F5 が割り当てられることが多いが、
その他のショートカットが割り当てられることもあるので、メニューで確認しておくこと。

ビルドと実行の方法が確認できたら、Program.cs の内容を書き換えて開発を行っていく。

\section{開発の中断と再開}

開発を一旦中断する際は、「ファイル」→「全て保存」を選択した後、
VS を修了すればよい。

開発を再開する際には、以下の2つの方法がある。

\begin{itemize}
 \item VS を起動し、「コードなしで続行」を選択した後、
	「ファイル」→「開く」→「プロジェクト/ソリューション」を選択する。
	その後、プロジェクトが置いてあるフォルダの「sln」ファイルを選択する。

 \item エクスプローラーにてプロジェクトを保存したフォルダを開き、
	そのフォルダの中にある「sln」ファイルを選択する。
\end{itemize}

\section{ファイル読み込み処理を行うプログラムを実行する場合}
プログラム上から画像や形状データなどを読み込むプログラムを作成した場合、
カレントフォルダはビルドされた実行ファイルの存在しているフォルダになる。

\subsection{ビルドしたファイルを他の環境で実行する場合}
作成してビルドできたプログラムを他者の PC 環境で実行する場合は、
bin フォルダ中の実行ファイル(exeファイル)に加えて、
各種 dll も実行ファイルと同じフォルダに配置する必要がある。
更に、実行する PC に次の 2 つがインストールされている必要がある。

\begin{enumerate}
\item .NET Framework 4.5 以降
\item Visual C++ 2019 再頒布可能パッケージ(本パッケージインストール先の redist フォルダに収録)
\end{enumerate}

.NET Framework 4.5 は Windows Update か Microsoft のサイトから、
Visual C++ 2019 再頒布可能パッケージは、
本パッケージインストール先の redist フォルダに収録されている、
vcredist\_x86.exe を実行することでインストール可能である。
成果物を配布する際にはこのことを周知しておく必要がある。

\end{document}
