\documentclass[a4paper]{jsarticle}

\usepackage{ascmac}
\usepackage{boites}

\textwidth=520pt
\textheight=710pt
\oddsidemargin=-32pt
\evensidemargin=-32pt
\topmargin=-60pt

\begin{document}
\begin{center}
\begin{Large}
Fine Kernel ToolKit システム (Visual Studio CLI 版) \\
	セットアップマニュアル \\ ~ \\
FineKernel Project \\
\end{Large}
(2019/04/11版)
\end{center}

\section{Visual Studio のバージョンについて}
Fine Kernel ToolKit システム(以下 FK)は 
C\# や F\# などの .NET Framework 対応言語から利用可能な「CLI版」を提供している。
現時点では Visual Studio(以下 VS) 2017 をサポートしている。
本マニュアルでは、VS2017 Community を前提に記述していく。

\section{前準備}

インストールの前に、まず Windows Update をかけて
OS を最新の状態にしておくこと。また、
インストールに 10G を必要とするので、
最低でも 12G 程度はドライブに空きを作っておく必要がある。

\section{Visual Studio 2017 Community のインストール}
Visual Studio 2017 Community (以下「VS」)のインストール方法は以下の通り。

\begin{enumerate}
 \item まず、下記URLにアクセスする。
  \begin{screen}
  \begin{center}
	\verb+https://visualstudio.microsoft.com/jp/downloads/+
  \end{center}
  \end{screen}

 \item ページ内にある Visual Studio 2017 欄内の「コミュニティ」を選択する。

 \item ダウンロードされるインストーラを起動する。

 \item インストールする項目のうち、最低以下の2項目を選択しておく。
	\begin{itemize}
	 \item ユニバーサル Windows プラットフォーム開発
	 \item .NET デスクトップ開発
	\end{itemize}
	その他の項目については、適宜自身が必要と思う項目を追加しておくとよい。

 \item 本体のインストールが終わるまで待つ。数十分を要する。

 \item 再起動が必要というダイアログが出た場合は、一度再起動する。

 \item マイクロソフトアカウントを取得していない場合、事前に取得しておく。
	アカウントの設定を行わなくても使用はできるが、
	30日で使用できなくなるので必ず取得して Visual Studio 内で登録しておくこと。

 \item Visual Studio 2017 を起動する。
	初回の起動は数分かかることがあるので、しばらく待つ。

 \item 起動を確認したら終了する。

\end{enumerate}

\section{マイクロソフトアカウントの設定}

VS は、利用の際にマイクロソフトアカウントでサインインをしておく必要がある。
既に Skype や OneDrive、あるいは Windows ストア等を利用していて、
マイクロソフトアカウントを取得済みの場合、
それをそのまま用いてもよい。

マイクロソフトアカウントをまだ持ってない人は新規に取得する。
以下のページにアクセスする。
\begin{screen}
\begin{center}
	\verb+https://login.live.com/+
\end{center}
\end{screen}
ここで「アカウントをお持ちでない場合、作成できます。」の「作成」の部分をクリックし、
あとは指示に従う。
大学のメールアドレスを利用することを推奨するが、
その他のアドレスをアカウントとして利用しても、
新規にメールアドレスを作成してもよい。

なお、マイクロソフトではアカウント作成処理が同一 IP アドレスから行われた場合、
作成数を制限している。この処理のため、学内ネットワークから大勢が同時間に作成処理を
行うと、エラーとなってしまう。そのため、この作成は自宅で行うか、
スマートフォンを用いて行うことを推奨する。

\section{FK CLI 版のインストール}

C\# で FK のプログラミングを行うには、FK CLI版をインストールする必要がある。
これは以下の URL から「FK\_CLI」で始まるインストーラ(exeファイル)をダウンロードする。

\begin{screen}
\begin{center}
	\verb+http://osdn.jp/projects/fktoolkit/releases+
\end{center}
\end{screen}
ダウンロードの際、「ダウンロードしたユーザー数が少ないため、PCに問題を起こす可能性があります。」
というメッセージが表記される場合があるが、問題はない。

このインストーラを実行しようとすると、
「Windows によって PC が保護されました」というメッセージが表示される場合があるが、
その場合は「詳細情報」をクリックして「実行」を選択する。あとは基本的に指示通りに
インストールを進めればよい。

インストールが終わった後、一度サインアウトか再起動を行っておくこと。

\section{開発の手順}

VS 上で FK を用いた C\# の開発は、まず「プロジェクト」を作成するところから
始める。プロジェクトの作成方法は以下の手順で行う。

\begin{enumerate}

 \item VS を起動する。

 \item 「ソリューションエクスプローラー」が表示されていない場合は、メニューの
	「表示」→「ソリューションエクスプローラー」を選択して表示させておく。

 \item 「ファイル」→「新規作成」→「プロジェクト」を選択する。

 \item 「新しいプロジェクト」ダイアログの左側で「テンプレート」→「Visual C\#」
	(または「テンプレート」→「その他の言語」→「Visual C\#」) を選択する。

 \item 同ダイアログの右側で「FK\_CLI\_Template」を選択する。

 \item 名前を適当に入力し、場所の欄にプログラムソース等を置くフォルダを指定する。

 \item 「OK」ボタンを押す。

\end{enumerate}

これで準備は完了である。

\section{ビルドと実行}

上記手順で作成したプロジェクトには、最初から「Program.cs」にサンプルコードが
記述されている。その状態でメニューの「ビルド」→「ソリューションのビルド」を選択することで
ビルド(コンパイル)ができる。その後、メニューの「デバッグ」→「デバッグの開始」で実行できる。
ショートカットキーは、ビルドが F6、実行は F5 が割り当てられることが多いが、
その他のショートカットが割り当てられることもあるので、メニューで確認しておくこと。

ビルドと実行の方法が確認できたら、Program.cs の内容を書き換えて開発を行っていく。

\section{開発の中断と再開}

開発を一旦中断する際は、「ファイル」→「全て保存」を選択した後、
VS を修了すればよい。

開発を再開する際には、以下の2つの方法がある。

\begin{itemize}
 \item VS を起動し、「ファイル」→「開く」→「プロジェクト/ソリューション」を選択する。
	その後、プロジェクトが置いてあるフォルダの「sln」ファイルを選択する。

 \item エクスプローラーにてプロジェクトを保存したフォルダを開き、
	そのフォルダの中にある「sln」ファイルを選択する。
\end{itemize}

\section{開発に関する諸注意}
\subsection{ファイル読み込み処理を行うプログラムを実行する場合}
プログラム上から画像や形状データなどを読み込むプログラムを作成した場合、
カレントフォルダはビルドされた実行ファイルの存在しているフォルダになる。

\subsection{ビルドしたファイルを他の環境で実行する場合}
作成してビルドできたプログラムを他者の PC 環境で実行する場合は、
bin フォルダ中の実行ファイルに加えて、FK\_CLI.dll も実行ファイルと同じフォルダに配置する必要がある。
Windows フォームや WPF を利用している場合は、FK\_FormHelper.dll も必要である。
更に、実行する PC に次の 3 つがインストールされている必要がある。

\begin{enumerate}
\item .NET Framework 4.5 以降
\item OpenAL(本パッケージインストール先の redist フォルダに収録)
\item Visual C++ 2017 再頒布可能パッケージ(本パッケージインストール先の redist フォルダに収録)
\end{enumerate}

.NET Framework 4.5 は Windows Update か Microsoft のサイトから、
OpenAL と Visual C++ 2017 再頒布可能パッケージは、
本パッケージインストール先の redist フォルダに収録されている、
oalinst.exe と vcredist\_x86.exe を実行することでインストール可能である。
成果物を配布する際にはこのことを周知しておく必要がある。

\subsection{デバッグ用ライブラリの利用}
FK CLI 版が内部で利用している「C++/CLI」という技術はやや不安定な面があり、
時折途中で処理が止まってしまうことがある。
そのような場合、以下の手順で「デバッグ版」を利用することで、動作が正常となる場合がある。
\begin{enumerate}
 \item VS で「プロジェクトエクスプローラー」を表示する。
 \item 該当プロジェクトの「参照」から「FK\_CLI」を削除する。
 \item メニューの「プロジェクト」→「参照の追加」を選択する。
 \item 表示される「参照マネージャー」というダイアログで、下側の「参照」というボタンを押す。
 \item FK\_CLIフォルダ(通常はCドライブ直下)の下の
	「bin」→「x86」→「FK\_CLI\_d.dll」というファイルを選択する。
\end{enumerate}
以上の手順で、実行時に通常版ではなくデバッグ版を参照するようになる。

\end{document}
